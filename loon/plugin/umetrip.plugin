# Umetrip (航旅纵横) Remove Ads - 2025-11 STRICT
# Author: ChatGPT
# Goal: Block splash ads even when CDN switches to Ali (ossgw.alicdn.com / mPaaS).
# Notes:
# - Keep gateway traffic for core functions.
# - May be slightly aggressive; if a feature breaks, share the hit URL from logs and I'll relax it.
#!name= 航旅纵横-去广告-2025-11-STRICT
#!desc= 最后更新时间 2025-11-01。屏蔽航旅纵横 App 内的开屏广告及其他广告资源，支持官方 OSS 及 Ali CDN 镜像（ossgw.alicdn.com）和 mPaaS（Aliyun OSS）路径。规则较为严格，如发现功能异常，请提供日志中的命中 URL 以便调整规则。
#!openUrl= https://github.com/DUANKD/ios_rule_config
#!author= blackmatrix7
#!homepage= https://github.com/DUANKD/ios_rule_config
#!icon= https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/icon/color/umetrip.png
#!reject= 740
#!mitm= 698
#!total= 1438
#!system = iOS,iPadOS,tvOS,macOS
#!system_version = 15
#!loon_version = 3.2.1(372)
#!tag = 去广告

[MITM]
hostname = oss.umetrip.com, api.umetrip.com, ossgw.alicdn.com, *.aliyuncs.com

[Rewrite]
# ---- Primary (official OSS) ----
^https?:\/\/oss\.umetrip\.com\/fs\/advert\/polite.* reject-dict
^https?:\/\/oss\.umetrip\.com\/fs\/advert\/.* reject-dict

# ---- Ali CDN mirror of the same bucket ----
^https?:\/\/ossgw\.alicdn\.com\/.*\/fs\/advert\/polite.* reject-dict
^https?:\/\/ossgw\.alicdn\.com\/.*\/fs\/advert\/.* reject-dict

# ---- mPaaS (Ali) possible splash delivery paths (conservative) ----
^https?:\/\/(?:[a-z0-9.-]+\.)?aliyuncs\.com\/.*/advert\/.* reject-dict
^https?:\/\/(?:[a-z0-9.-]+\.)?aliyuncs\.com\/.*/ads?\/.* reject-dict

# ---- Legacy API ad endpoints ----
^https?:\/\/api\.umetrip\.com\/api\/(ad|advert)\/.* reject-dict

# ---- Safeguard: do NOT block app gateway (business APIs) ----
# (No rule here; we simply avoid matching /gateway/)